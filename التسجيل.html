<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HOBA TECH | التسجيل</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
body {
  margin:0; padding:0; font-family:'Cairo',sans-serif;
  background:#050505; color:white; display:flex; justify-content:center; align-items:center; height:100vh;
}
.auth-card { background: rgba(255,255,255,0.05); padding:30px; border-radius:25px; width:350px; text-align:center; backdrop-filter:blur(20px); }
.auth-card h2 { color:#0044cc; font-size:28px; margin-bottom:10px; letter-spacing:2px; }
.auth-card p { font-size:14px; color:#bbb; margin-bottom:20px; }
input, select { width:100%; padding:12px 15px; background: rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); border-radius:12px; color:white; outline:none; margin-top:10px; }
input:focus, select:focus { border-color:#0044cc; background: rgba(0,68,204,0.1); }
.btn-auth { width:100%; padding:12px; background:#0044cc; border:none; color:white; border-radius:12px; font-weight:bold; cursor:pointer; margin-top:10px; }
.btn-auth:hover { box-shadow:0 0 20px #0044cc; transform:scale(1.02); }
.switch-text { margin-top:20px; font-size:13px; }
.switch-text span { color:#0044cc; cursor:pointer; font-weight:bold; text-decoration:underline; }
#error-msg { color:#ff4444; font-size:12px; margin-top:10px; min-height:18px; }
</style>
</head>
<body>

<div class="auth-card">
<h2>HOBA TECH</h2>
<p id="title">مرحباً بك يا مستشار</p>

<!-- Login Form -->
<div id="login-form">
  <input type="email" id="l-email" placeholder="البريد الإلكتروني">
  <input type="password" id="l-pass" placeholder="كلمة السر">
  <button class="btn-auth" id="login-btn">دخول</button>
  <button class="btn-auth" id="phone-login-btn">تسجيل دخول برقم الهاتف</button>
  <p class="switch-text">ليس لديك حساب؟ <span onclick="toggleMode()">أنشئ حسابك الآن</span></p>
</div>

<!-- Signup Form -->
<div id="signup-form" style="display:none;">
  <input type="text" id="s-name" placeholder="الاسم الكامل">
  <input type="tel" id="s-phone" placeholder="رقم الهاتف">
  <select id="s-group">
    <option value="" disabled selected>اختر الفرقة</option>
    <option>الفرقة الأولى</option>
    <option disabled>الفرقة الثانية (مقفلة)</option>
    <option disabled>الفرقة الثالثة (مقفلة)</option>
    <option disabled>الفرقة الرابعة (مقفلة)</option>
  </select>
  <input type="email" id="s-email" placeholder="البريد الإلكتروني">
  <input type="password" id="s-pass" placeholder="كلمة السر">
  <button class="btn-auth" id="signup-btn">تأكيد الاشتراك</button>
  <p class="switch-text">عندك حساب؟ <span onclick="toggleMode()">سجل دخولك</span></p>
</div>

<!-- OTP Form -->
<div id="otp-form" style="display:none;">
  <p>أدخل الكود المرسل على رقم الهاتف</p>
  <input type="text" id="otp-code" placeholder="OTP">
  <button class="btn-auth" id="verify-otp-btn">تأكيد الكود</button>
</div>

<div id="error-msg"></div>
</div>

<script type="module">
// Firebase imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, RecaptchaVerifier, signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAjpqfDdoxYs8rRBw4UKOrvtMoqBDB0Z_s",
  authDomain: "hoba-tech.firebaseapp.com",
  projectId: "hoba-tech",
  storageBucket: "hoba-tech.firebasestorage.app",
  messagingSenderId: "465948708700",
  appId: "1:465948708700:web:dac008d1cb9f8caa50fb99"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const database = getDatabase(app);

// Toggle between login/signup
window.toggleMode = function() {
  const loginForm = document.getElementById('login-form');
  const signupForm = document.getElementById('signup-form');
  const title = document.getElementById('title');
  if(loginForm.style.display==='none') {
    loginForm.style.display='block';
    signupForm.style.display='none';
    title.innerText="مرحباً بك يا مستشار";
  } else {
    loginForm.style.display='none';
    signupForm.style.display='block';
    title.innerText="انضم لعائلة هوبا تيك";
  }
};

// Signup
document.getElementById('signup-btn').addEventListener('click', () => {
  const name = document.getElementById('s-name').value;
  const phone = document.getElementById('s-phone').value;
  const group = document.getElementById('s-group').value;
  const email = document.getElementById('s-email').value;
  const password = document.getElementById('s-pass').value;
  const errorMsg = document.getElementById('error-msg');

  if(!name||!phone||!group||!email||!password){ errorMsg.innerText="يرجى ملء جميع الحقول"; return; }

  createUserWithEmailAndPassword(auth,email,password)
    .then(userCredential=>{
      const user = userCredential.user;
      set(ref(database,'users/'+user.uid),{
        name,name, phone, group, email
      });
      alert("تم التسجيل بنجاح!");
      window.location.href="داش 4.html";
    })
    .catch(error=>{ errorMsg.innerText="خطأ: "+error.message; });
});

// Login with email
document.getElementById('login-btn').addEventListener('click',()=>{
  const email = document.getElementById('l-email').value;
  const password = document.getElementById('l-pass').value;
  const errorMsg = document.getElementById('error-msg');

  signInWithEmailAndPassword(auth,email,password)
    .then(userCredential=>{
      alert("تم تسجيل الدخول!");
      window.location.href="داش 4.html";
    })
    .catch(error=>{ errorMsg.innerText="خطأ: البريد أو كلمة السر"; });
});

// Login with phone
document.getElementById('phone-login-btn').addEventListener('click',()=>{
  const phone = prompt("أدخل رقم الهاتف مع +20");
  if(!phone) return;

  // Render recaptcha
  window.recaptchaVerifier = new RecaptchaVerifier('phone-login-btn', { 'size':'invisible' }, auth);

  signInWithPhoneNumber(auth,phone,window.recaptchaVerifier)
    .then(confirmationResult=>{
      window.confirmationResult = confirmationResult;
      document.getElementById('login-form').style.display='none';
      document.getElementById('otp-form').style.display='block';
    })
    .catch(error=>{ document.getElementById('error-msg').innerText="خطأ في رقم الهاتف"; });
});

// Verify OTP
document.getElementById('verify-otp-btn').addEventListener('click',()=>{
  const code = document.getElementById('otp-code').value;
  window.confirmationResult.confirm(code)
    .then(result=>{
      alert("تم تسجيل الدخول برقم الهاتف!");
      window.location.href="داش 4.html";
    })
    .catch(err=>{
      document.getElementById('error-msg').innerText="كود OTP غير صحيح";
    });
});

// Auto-login if already signed in
onAuthStateChanged(auth,user=>{
  if(user) window.location.href="داش 4.html";
});
</script>

</body>
</html>
