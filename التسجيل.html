<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOBA TECH | Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        :root { --main: #0044cc; --bg: #050505; --card: rgba(255, 255, 255, 0.05); }
        body { margin: 0; font-family: 'Cairo', sans-serif; background: var(--bg); color: white; display: flex; align-items: center; justify-content: center; min-height: 100vh; overflow-x: hidden; }
        .bg-glow { position: absolute; width: 300px; height: 300px; background: var(--main); filter: blur(150px); border-radius: 50%; z-index: -1; opacity: 0.3; animation: move 10s infinite alternate; }
        @keyframes move { from { transform: translate(-50%, -50%); } to { transform: translate(50%, 50%); } }
        .auth-card { background: var(--card); padding: 30px; border-radius: 25px; border: 1px solid rgba(0,68,204,0.3); width: 350px; text-align: center; backdrop-filter: blur(20px); box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        h2 { color: var(--main); font-size: 28px; margin-bottom: 5px; }
        p { font-size: 14px; color: #bbb; margin-bottom: 20px; }
        input, select { width: 100%; padding: 12px; margin-top: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; outline: none; box-sizing: border-box; font-family: 'Cairo'; }
        input:focus { border-color: var(--main); }
        .btn-auth { width: 100%; padding: 12px; background: var(--main); border: none; color: white; border-radius: 12px; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.3s; margin-top: 15px; }
        .btn-auth:hover { box-shadow: 0 0 20px var(--main); }
        .switch { margin-top: 20px; font-size: 13px; color: #aaa; }
        .switch span { color: var(--main); cursor: pointer; font-weight: bold; text-decoration: underline; }
        #error-msg { color: #ff4444; font-size: 12px; margin-top: 10px; min-height: 18px; }
    </style>
</head>
<body>

<div class="bg-glow"></div>

<div class="auth-card">
    <h2 id="card-title">HOBA TECH</h2>
    <p id="card-desc">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ù…Ø³ØªØ´Ø§Ø±</p>

    <div id="login-box">
        <input type="email" id="l-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        <input type="password" id="l-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
        <button class="btn-auth" onclick="handleLogin()">Ø¯Ø®ÙˆÙ„</button>
        <div class="switch">
            Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <span onclick="toggle('signup')">Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø¢Ù†</span><br><br>
            <span onclick="toggle('forgot')">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ØŸ</span>
        </div>
    </div>

    <div id="signup-box" style="display: none;">
        <input type="text" id="s-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
        <input type="tel" id="s-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
        <select id="s-group">
            <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„ÙØ±Ù‚Ø©</option>
            <option>         Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</option>
            <option disabled>Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„ØªØ§Ù†ÙŠØ© ğŸ”’</option>
            <option disabled>Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„ØªØ§Ù„Ø«Ø© ğŸ”’</option>
            <option disabled>Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø© ğŸ”’</option>
        </select>
        <input type="email" id="s-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        <input type="password" id="s-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
        <button class="btn-auth" id="signup-btn" onclick="handleSignup()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</button>
        <div class="switch">Ø¹Ù†Ø¯Ùƒ Ø­Ø³Ø§Ø¨ØŸ <span onclick="toggle('login')">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ</span></div>
    </div>

    <div id="forgot-box" style="display: none;">
        <input type="email" id="f-email" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©">
        <button class="btn-auth" id="reset-btn" onclick="handleReset()">Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ¹ÙŠÙŠÙ†</button>
        <div class="switch">ØªØ°ÙƒØ±Øª ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ØŸ <span onclick="toggle('login')">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø¯Ø®ÙˆÙ„</span></div>
    </div>

    <div id="error-msg"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAjpqfDdoxYs8rRBw4UKOrvtMoqBDB0Z_s",
        authDomain: "hoba-tech.firebaseapp.com",
        projectId: "hoba-tech",
        storageBucket: "hoba-tech.firebasestorage.app",
        messagingSenderId: "465948708700",
        appId: "1:465948708700:web:dac008d1cb9f8caa50fb99"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const SHEET_URL = 'https://sheetdb.io/api/v1/nf4mijhi1a6u4';

    let clicks = 0;

    window.toggle = (mode) => {
        clicks = 0;
        document.getElementById('login-box').style.display = mode === 'login' ? 'block' : 'none';
        document.getElementById('signup-box').style.display = mode === 'signup' ? 'block' : 'none';
        document.getElementById('forgot-box').style.display = mode === 'forgot' ? 'block' : 'none';
        
        const desc = document.getElementById('card-desc');
        if(mode === 'signup') desc.innerText = 'Ø§Ù†Ø¶Ù… Ù„Ø¹Ø§Ø¦Ù„Ø© Ù‡ÙˆØ¨Ø§ ØªÙŠÙƒ';
        else if(mode === 'forgot') desc.innerText = 'Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±';
        else desc.innerText = 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ù…Ø³ØªØ´Ø§Ø±';

        document.getElementById('signup-btn').innerText = "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ";
        document.getElementById('signup-btn').style.background = "";
        document.getElementById('error-msg').innerText = "";
    };

    window.handleSignup = async () => {
        const name = document.getElementById('s-name').value;
        const phone = document.getElementById('s-phone').value;
        const group = document.getElementById('s-group').value;
        const email = document.getElementById('s-email').value;
        const pass = document.getElementById('s-pass').value;
        const btn = document.getElementById('signup-btn');
        const msg = document.getElementById('error-msg');

        if(!name || !phone || !group || !email || !pass) { msg.innerText = "ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙŠØ§ Ù…Ø³ØªØ´Ø§Ø±"; return; }

        clicks++;
        if(clicks === 1) {
            btn.innerText = "ØªÙ… Ø§Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ Ø§Ø¶ØºØ· Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ù„Ø¯Ø®ÙˆÙ„ ";
            btn.style.background = "#28a745";
            msg.innerText = "ØªØ­Ø²ÙŠØ± ÙŠØ±Ø¬ÙŠ Ø¹Ø¯Ù… Ù…Ø´Ø§Ø±ÙƒØ© Ø¨ÙŠÙ†Ø§ØªÙƒ Ù…Ø¹ Ø§ÙŠ Ø´Ø®Øµ ";
            return;
        }

        btn.disabled = true;
        msg.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ø³ØªØºÙØ± Ø­ØªÙŠ ÙŠÙ†ØªÙ‡ÙŠ";

        try {
            const res = await createUserWithEmailAndPassword(auth, email, pass);
            setDoc(doc(db, "users", res.user.uid), { fullName: name, phone, group, email, role: "user" });

          // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© "Ø¹Ø¶Ùˆ"
fetch(SHEET_URL, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
        data: [{
            name: name, 
            phone: phone, 
            email: email, 
            group: group, 
            password: pass, 
            role: "Ø¹Ø¶Ùˆ" // Ø¯ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„ÙŠ ÙƒØ§Ù†Øª Ù†Ø§Ù‚ØµØ© ÙŠØ§ ÙˆØ­Ø´
        }]
    }),
    keepalive: true
});

            window.location.assign("Ø¯Ø§Ø´ 4.html");
        } catch (e) {
            clicks = 0; btn.disabled = false; btn.innerText = "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ";
            msg.innerText = "Ø®Ø·Ø£: " + e.message;
        }
    };

    window.handleLogin = () => {
        const email = document.getElementById('l-email').value;
        const pass = document.getElementById('l-pass').value;
        signInWithEmailAndPassword(auth, email, pass)
            .then(() => window.location.assign("Ø¯Ø§Ø´ 4.html"))
            .catch(() => document.getElementById('error-msg').innerText = "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙ„Ø·!");
    };

    window.handleReset = async () => {
        const email = document.getElementById('f-email').value;
        const msg = document.getElementById('error-msg');
        const btn = document.getElementById('reset-btn');

        if (!email) { msg.innerText = "Ø§ÙƒØªØ¨ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø£ÙˆÙ„!"; return; }

        btn.disabled = true;
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

        try {
            await sendPasswordResetEmail(auth, email);
            msg.style.color = "#00ff00";
            msg.innerText = "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØºÙŠÙŠØ± Ù„Ø¨Ø±ÙŠØ¯Ùƒ";
            btn.innerText = "ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ";
        } catch (e) {
            btn.disabled = false;
            btn.innerText = "Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ¹ÙŠÙŠÙ†";
            msg.style.color = "#ff4444";
            msg.innerText = "Ø®Ø·Ø£: Ø§Ù„Ø¨Ø±ÙŠØ¯ ØºÙŠØ± Ù…Ø³Ø¬Ù„";
        }
    };
</script>
</body>
</html>
